#!/usr/bin/env bash
# bin/test-compile <build-dir> <cache-dir> <env-dir>

# Fail immediately on non-zero exit code.
set -e
# Fail immediately on non-zero exit code within a pipeline.
set -o pipefail
# Fail on undeclared variables.
set -u
# Debug, echo every command
#set -x

# parse and derive params
BUILD_DIR="${1:-}"
CACHE_DIR="${2:-}"
ENV_DIR="${3:-}"
BP_DIR=`cd $(dirname $0); cd ..; pwd`

# Main compile
eval "bin/compile $@"

topic "Installing Lua rocks specified in .luarocks_test"
cd ${BUILD_DIR}
LUAROCKS_SPEC=.luarocks_test ${BP_DIR}/bin/install-luarocks
